<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CLEAN MARKUP = GOOD KARMA.
      Hi source code lover,

      you're a curious person and a fast learner ;)
      Let's make something beautiful together. Contribute on Github:
      https://github.com/webslides/webslides

      Thanks!
    -->

    <!-- SEO -->
    <title>Woocommerce CVEs</title>
    <meta name="description" content="Woocommerce CVEs">

    <!-- URL CANONICAL -->
    <!-- <link rel="canonical" href="http://your-url.com/permalink"> -->

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&amp;subset=latin-ext" rel="stylesheet">

    <!-- CSS Base -->
    <link rel="stylesheet" type='text/css' media='all' href="../static/css/webslides.css">

    <!-- Optional - CSS SVG Icons (Font Awesome) -->
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/svg-icons.css">

    <!-- Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">
  </head>
  <body>

    <main role="main">
      <article id="webslides">

        <!-- Quick Guide
          - Each parent <section> in the <article id="webslides"> element is an individual slide.
          - Vertical sliding = <article id="webslides" class="vertical">
          - <div class="wrap"> = container 90% / <div class="wrap size-50"> = 45%;
        -->
        <audio autoplay hidden>
		      <source src="../static/videos/homesick.mp3" type="audio/mp3">
		    </audio>
        <section class="bg-apple">
          <!--.wrap = container (width: 90%) -->
          
          <div class="wrap">
            <h1><img class="logo aligncenter" src="../static/images/logos/woo.svg" alt="Woocommerce"></h1>  
          </div>
          <div class= "wrap"id="particles-js">
            <script src="../static/js/particles.js"></script>
            <script src="../static/js/app.js"></script>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('../static/images/moontower.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">       
            <h1>WooCommerce CVEs</h1>
            <p class="text-intro">Web and application security.</p>
            <p><code>.Presentation</code></p>
          </div>
          <!-- .end .wrap -->
  
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <!--.wrap = container (width: 90%) -->
          <header>
            <br><br><h1>Whoami</h1>
          </header>
             <ul class="description">
              <h3><li><span class="text-subtitle">16521247 --</span> Tinh Bui Tan</li></h3><br>
              <h3><li><span class="text-subtitle">16520354 --</span> Hau Dinh Trung</li></h3>
              <h4><li><span></span>ANTN2016</li><h4><br>
            </ul>
            <h3><img class="round zoomIn" src="../static/images/troll.jpg" alt="trollface"></h3>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple">
          <div class="wrap">
            <h2>Overview</h2>
            <ul class="flexblock features">
              <li>
                <div>
                  <h2>
                    <span>&rarr;</span>
                    Introduction
                  </h2>
                  woocommerce plugin
                </div>
              </li>
              <li>
                <div>
                  <h2>
                    <svg class="fa-link">
                      <use xlink:href="#fa-link"></use>
                    </svg>
                    CVE 2018-20148
                  </h2>
                  POI via Metadata.
                </div>
              </li>
              <li>
                <div>
                  <h2>
                    <svg class="fa-clock-o">
                      <use xlink:href="#fa-clock-o"></use>
                    </svg>
                    Phar 101
                  </h2>
                  basic knowledge
                </div>
              </li>
              <li>
                <div>
                  <h2>
                    <span>&rarr;</span>
                    CVE 2019-9168
                  </h2>
                  Photoswipe Caption XSS
                </div>
              </li>
              <li>
                <div>
                  <h2>
                    <svg class="fa-text-height">
                      <use xlink:href="#fa-text-height"></use>
                    </svg>
                    Appendix
                  </h2>
                  extra information
                </div>
              </li>
              <li>
                <div>
                  <h2>
                    <svg class="fa-text-height">
                      <use xlink:href="#fa-text-height"></use>
                    </svg>
                    Endgame.
                  </h2>
                  wakanda 4ever
                </div>
              </li>
            </ul>
          </div>
        </section>
        <section class="bg-apple">
          <div class="wrap">
            <div class="content-left">
              <h2>WooCommerce</h2>
            </div>
            <!-- end .content-left -->
            <div class="content-left">
              <p>An open-source e-commerce plugin for Wordpress.</p>
              <p>The most popular eCommerce platform in the world</p>
              <p>Acquired by Automattic in 2015 (the company behind Wordpress)</p>
            </div>
            <!-- end .content-left -->
            <ul class="flexblock">
              <li>
                <div>
                  <img class="round" src="../static/images/auto.jpg" alt="Automattic">
                </div>
              </li>
              <li>
                <div>
                  <img class="round" src="../static/images/wp.png" alt="Wordpress">
                </div>
              </li>
              <li>
                <div>
                  <img class="round" src="../static/images/woo.png" alt="Woocommerce">
                </div>
              </li>
            </ul>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <img src="../static/images/char.png">
        </section>
        <section class="bg-apple aligncenter">
          <img src="../static/images/char2.png">
        </section>
        <section class="bg-apple aligncenter">
          <img src="../static/images/news.png">
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('../static/images/moonmoutain.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">       
            <h1>CVE 2018-20148</h1>
            <p class="text-intro">PHP Object Injection via Metadata.</p>
            <p><code>.Phar://</code></p>
          </div>
          <!-- .end .wrap -->
        </section>

        <section class="bg-apple">
          <div class="wrap">
            <div class="content-left">
              <h2>Description.</h2>
            </div>
            <!-- end .content-left -->
              
            <!-- end .content-left -->
            <ul class="flexblock metrics">
              <p> In WordPress before 4.9.9 and 5.x before 5.0.1, contributors could conduct PHP object injection attacks via crafted metadata in a wp.getMediaItem XMLRPC call. This is caused by mishandling of serialized data at phar:// URLs in the wp_get_attachment_thumb_file function in wp-includes/post.php. </p>
              <li> Base Score
                <span>9.8 critical </span>
              </li>
              <li>
                <span>
                  <svg class="fa-users">
                    <use xlink:href="#fa-users"></use>
                  </svg>
                </span>
                Impact 5.9
              </li>
              <li>
                <span>
                  <svg class="fa-line-chart">
                    <use xlink:href="#fa-line-chart"></use>
                  </svg>
                </span>
                Exploitability 3.9
              </li>
              <li>
                Published Date
                <span>12/14/2018</span>
              </li>
            </ul>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <div class="wrap zoomIn">
            <h1>
              <svg class="fa-apple">
                <use xlink:href="#fa-apple"></use>
              </svg>
              First introduced
            </h1>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('https://source.unsplash.com/pb_lF8VWaPU/')"></span>
          <div class="wrap">
            <h2 class="text-data">Black Hat 2018 </h2>
            <h3>by Sam Thomas</h3>
             <blockquote>
                <p>&ldquo;Itâ€™s a PHP unserialization vulnerability Jim, but not as we know it..&rdquo;</p>
              </blockquote>
          </div>
          <!-- .end .wrap -->
        </section>
        </section>
        <section class="bg-apple aligncenter">
          <!-- Overlay/Opacity: [class*="bg-"] > .background.dark or .light -->
          <span class="background" style="background-image:url('../static/images/moonsnow.jpg')"></span>
          <div class="wrap">
            <div class="content-left">
              <p>
                <svg class="large fa-tree">
                  <use xlink:href="#fa-tree"></use>
                </svg>
              </p>
              <h2><span>Phar 101</span></h2>
              <h3>Basic knowledge we need to know .</h3>
            </div>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple">
           <div class="wrap">
            <blockquote class="text-quote">
              <p>Phar (PHP Archive) == JAR (Java Archive)   &&    Stream wrapper: allow us to access files inside a local archive.</p>
              <p>
                <cite>
                  <!-- <img class="avatar-56" src="../static/images/avatar.jpg" alt="Avatar"> --> Ex: Phar:// == ftp:// == zlib://
                </cite>
              </p>
            </blockquote>
          </div>
          <hr>
          <div class="wrap ">
            <h2 class="aligncenter">Phar file</h2>
            <p class="aligncenter">stored in format: PHAR, TAR, ZIP.</p>
            <ul class="flexblock blink">
              <li>
                <a href="#" title="Stub">
                  <h2>Stub</h2>
                  <div>
                    <span class="price">__HALT_COMPILER();?></span>
                    <p>a flag to recognize phar file.</p>
                  </div>
                </a>
              </li>
              <li>
                <a href="#" title="Manifest">
                  <h2>Manifest</h2>
                  <div>
                    <span class="price">Metadata stored in serialized form</span>
                    <p>describing the contents, attributes.</p>
                  </div>
                </a>
              </li>
              <li>
                <a href="#" title="Content">
                  <h2>Contents </h2>
                  <div>
                    <p class="price">Just contents of the compressed file.</p>
                  </div>
                </a>
              </li>
              <li>
                <a href="#" title="Signature">
                  <h2>Signature </h2>
                  <div>
                    <p class="price">use to check integrity</p>
                    <p>4 bytes signature flags (MD5, SHA1, â€¦) + 4 bytes magic GNMB + actual signature.</p>
                  </div>
                </a>
              </li>
            </ul>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple">
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h2>
                  Metadata
                </h2>
                <p class="text-intro"><br>Any file operation on phar file <span>&rarr;</span>auto trigger deserialization</p>
                <ul class="description">
                  <li>
                    <blockquote class="text-quote">Open the door to unserialize attacks. Attacker can control with his owned path</blockquote>
                  </li>
                </ul>
              </div>
              <!-- end .column-->
              <div class="column">
                <figure>
                  <img src="../static/images/meta.png" alt="Metadata">
                </figure>
              </div>
              <!-- end figure-->
            </div>
            <!-- end .grid-->
          </div>
          <!-- end .wrap-->
        </section>
        <section class="bg-apple">
          <div class="wrap">
            <h3>Exploitation</h3>
            <ul class="flexblock steps">
              <!-- li>a? Add blink = <ul class="flexblock steps blink">-->
              <li class="bg-apple">
                <span>
                  <svg class="fa-heartbeat">
                    <use xlink:href="#fa-heartbeat"></use>
                  </svg>
                </span>
                <h2>01. A valid phar file</h2>
                <p>containing stub, maybe malicious code.</p>
              </li>
              <li class="bg-apple">
                <div class="process step-2"></div>
                <span>
                  <svg class="fa-magic">
                    <use xlink:href="#fa-magic"></use>
                  </svg>
                </span>
                <h2>02. Place phar file</h2>
                <p>onto target's local file system</p>
              </li>
              <li class="bg-apple">
                <div class="process step-3"></div>
                <span>
                  <svg class="fa-balance-scale">
                    <use xlink:href="#fa-balance-scale"></use>
                  </svg>
                </span>
                <h2>03. Trigger a file operation</h2>
                <p>ex: file_exist().</p>
              </li>
              <li class="bg-apple">
                <div class="process step-4"></div>
                <span>
                  <svg class="fa-cog">
                    <use xlink:href="#fa-cog"></use>
                  </svg>
                </span>
                <h2>04. Phar:// -> file</h2>
                <p>Blooooom!!!</p>
              </li>
            </ul>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="fullscreen">
          <div class="bg-apple">
            <div class="card-50">
            <figure>
              <img src="../static/images/sunset.jpg" alt="Yosemite National Park">
              <figcaption>
                <a href="" title="@sunset">
                  <svg class="fa-camera">
                    <use xlink:href="#fa-camera"></use>
                  </svg>
                  @sunset
                </a>
              </figcaption>
            </figure>
            <div class="flex-content">
              <h2>
                Solution?
              </h2>
              <p>
                Update WordPress to the latest available version (at least 5.0.1).
              </p>
              <ul>
                <li>https://cdn2.hubspot.net/hubfs/3853213/us-18-Thomas-It's-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-....pdf</li>
                <li> https://paper.seebug.org/988/</li>
              </ul>
            </div>
            <!-- end .flex-content-->
          </div>
          <!-- end .card-50-->
            <!-- end figure-->
          </div>            
        </section>
        <section class="bg-apple aligncenter">
          <div class="wrap zoomIn">
            <h1>
              <svg class="fa-apple">
                <use xlink:href="#fa-apple"></use>
              </svg>
              Demo
            </h1>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="fullscreen bg-black aligncenter">
          <div class="embed light">
             <video autoplay loop muted poster="https://webslides.tv/static/images/peggy.jpg">
             <source src="../static/videos/phar-2019-11-11_10.35.12.mp4" type="video/mp4">
            </video>
          </div><!-- .embed -->
          <!-- .wrap = container (width: 90%) -->
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('../static/images/cresent.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">       
            <h1>CVE 2019-9168 </h1>
            <p class="text-intro">Photoswipe Caption cross site scripting.</p>
            <p><code>.Presentation</code></p>
          </div>
          <!-- .end .wrap -->
  
          <!-- .end .wrap -->
        </section>
        <section class="fullscreen">
          <div class="bg-apple">
            <div class="card-50 ">
              <img src="../static/images/moonsea.jpg">
            <div class="flex-content">
              <h2>
                Researched by
              </h2>
              <p>
                The FortiGuard Labs team .
              </p>
              <ul>
                <li>https://www.fortinet.com/blog/threat-research/wordpress-woocommerce-xss-vulnerability----hijacking-a-customer-.html</li>
              </ul>
            </div>
            <!-- end .flex-content-->
          </div>
          <!-- end .card-50-->
            <!-- end figure-->
          </div>            
        </section>
        <section class="bg-apple fullscreen">
          <pre class="fullscreen">
            <code class="php">
              includes/wc-template-functions.php
              $full_size         = apply_filters( 'woocommerce_gallery_full_size', apply_filters( 'woocommerce_product_thumbnails_large_size', 'full' ) );
              $thumbnail_src     = wp_get_attachment_image_src( $attachment_id, $thumbnail_size );
              $full_src          = wp_get_attachment_image_src( $attachment_id, $full_size );
              $image             = wp_get_attachment_image( $attachment_id, $image_size, false, array(
                'title'                   => get_post_field( 'post_title', $attachment_id ),
                'data-caption'            => get_post_field( 'post_excerpt', $attachment_id ),
                'data-src'                => $full_src[0],
                'data-large_image'        => $full_src[0],
                'data-large_image_width'  => $full_src[1],
                'data-large_image_height' => $full_src[2],
                'class'                   => $main_image ? 'wp-post-image' : '',
              ) );
              ####################################################################################################################################
              $image             = wp_get_attachment_image(
                $attachment_id,
                $image_size,
                false,
                apply_filters(
                  'woocommerce_gallery_image_html_attachment_image_params',
                  array(
                    'title'                   => _wp_specialchars( get_post_field( 'post_title', $attachment_id ), ENT_QUOTES, 'UTF-8', true ),
                    'data-caption'            => _wp_specialchars( get_post_field( 'post_excerpt', $attachment_id ), ENT_QUOTES, 'UTF-8', true ),
                    'data-src'                => esc_url( $full_src[0] ),
                    'data-large_image'        => esc_url( $full_src[0] ),
                    'data-large_image_width'  => esc_attr( $full_src[1] ),
                    'data-large_image_height' => esc_attr( $full_src[2] ),
                    'class'                   => esc_attr( $main_image ? 'wp-post-image' : '' ),
                  ),
                  $attachment_id,
                  $image_size,
                  $main_image
                )
              );

            </code>
          </pre>
        </section>
        <section >
          <span class="background light" style="background-image:url('../static/images/scenario.png')"></span>
        </section>
        <section class="bg-apple aligncenter">
          <div class="wrap zoomIn">
            <h1>
              <svg class="fa-apple">
                <use xlink:href="#fa-apple"></use>
              </svg>
              Demo
            </h1>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="fullscreen bg-black aligncenter">
          <div class="embed light">
             <video autoplay loop muted poster="https://webslides.tv/static/images/peggy.jpg">
             <source src="../static/videos/img-2019-11-11_11.22.12.mp4" type="video/mp4">
            </video>
          </div><!-- .embed -->
          <!-- .wrap = container (width: 90%) -->
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('../static/images/seamoutain.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">       
            <p class="text-intro">Slides nÃ y Ä‘Ã£ cÃ³ quáº£ng cÃ¡o.</p>
            <p><code>.KhÃ´ng Ä‘i lÃ m thÃ¬ sao cÃ³ slides</code></p>
          </div>
          <!-- .end .wrap -->
  
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple aligncenter">
          <span class="background light" style="background-image:url('../static/images/seahill.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">       
            <h1>Appendix.</h1>
          </div>
        </section>
        <section class="bg-apple">
          <div class="wrap">
            <div class="text-cols">
              <p><strong>XML-RPC </strong> is aÂ remote procedure callÂ (RPC)Â protocolÂ which usesÂ XMLÂ to encode its calls andÂ HTTPÂ as a transport mechanism.</strong></p>
              <p>In the past, there were security concerns with XML-RPC thus it was disabled by default.However SinceÂ <strong>WordPress 3.5.x, </strong> WordPress has had XML-RPC enabled by default because of some popular WordPress plugins like Jetpack even WordPress own app for both Android and iOS use XML-RPC. .</p>
            </div>
          </div>
          <!-- .end .wrap -->
        </section>
        <section class="bg-apple fullscreen">
          <pre class="fullscreen">
            <code class="php">
      #https://github.com/WordPress/WordPress/blob/master/wp-includes/post.php
      function wp_get_attachment_thumb_file( $post_id = 0 ) {
      $post_id = (int) $post_id;
      $post    = get_post( $post_id );
      if ( ! $post ) {
        return false;
      }
      $imagedata = wp_get_attachment_metadata( $post->ID );
      if ( ! is_array( $imagedata ) ) {
        return false;
      }
      $file = get_attached_file( $post->ID );
      if ( ! empty( $imagedata['thumb'] ) ) {
        $thumbfile = str_replace( wp_basename( $file ), $imagedata['thumb'], $file );
        if ( file_exists( $thumbfile ) ) {
          /**
           * Filters the attachment thumbnail file path.
           *
           * @since 2.1.0
           *
           * @param string $thumbfile File path to the attachment thumbnail.
           * @param int    $post_id   Attachment ID.
           */
          return apply_filters( 'wp_get_attachment_thumb_file', $thumbfile, $post->ID );
        }
      }
        return false;
      }

            </code>
          </pre>
        </section>
        <section class="bg-apple fullscreen">
          <pre class="fullscreen">
            <code class="php">
      #https://github.com/WordPress/WordPress/blob/master/wp-includes/post.php
        // If the file is relative, prepend upload dir.
        if ( $file && 0 !== strpos( $file, '/' ) && ! preg_match( '|^.:\\\|', $file ) ) {
          $uploads = wp_get_upload_dir();
          if ( false === $uploads['error'] ) {
            $file = $uploads['basedir'] . "/$file";
          }
        }
        if ( $unfiltered ) {
          return $file;
        }
        /**
         * Filters the attached file based on the given ID.
         *
         * @since 2.1.0
         *
         * @param string $file          Path to attached file.
         * @param int    $attachment_id Attachment ID.
         */
        return apply_filters( 'get_attached_file', $file, $attachment_id );
      }
            </code>
          </pre>
        </section>
                <section class="bg-apple fullscreen">
          <pre class="fullscreen">
            <code class="php">
      #https://github.com/woocommerce/woocommerce/blob/master/includes/log-handlers/class-wc-log-handler-file.php
      class WC_Log_Handler_File extends WC_Log_Handler {
        public function __destruct() {
        foreach ( $this->handles as $handle ) {
        if ( is_resource( $handle ) ) {
          fclose( $handle ); // @codingStandardsIgnoreLine.
          }
        }
      }
        return apply_filters( 'get_attached_file', $file, $attachment_id );
      }
            </code>
          </pre>
        </section>
        <section class="bg-apple aligncenter">
          <span class="background dark" style="background-image:url('../static/images/seahill.jpg')"></span>
          <h2 class="text-emoji zoomIn">ðŸ˜Ž</h2>
          <h3><strong>Thank you!</strong></h2>
            <h3>@webslides.tv</h3>
        </section>

      </article>
    </main>
    <!--main-->

    <!-- Required -->
    <script src="../static/js/webslides.js"></script>

    <script>
      window.ws = new WebSlides();
    </script>
    <script src="../static/js/particles.js"></script>
    <link rel="stylesheet" href="../static/css/styles/atom-one-dark.css">
    <script src="../static/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <!-- OPTIONAL - svg-icons.js (fontastic.me - Font Awesome as svg icons) -->
    <script defer src="../static/js/svg-icons.js"></script>

  </body>
</html>
